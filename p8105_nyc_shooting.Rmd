---
title: "p8105_nyc_shooting"
output: html_document
date: "2024-11-19"
---
```{r, message=FALSE}
library(sf)
library(dplyr)
library(readr)
library(stringr)
```
# This part focus on data cleaning, tidying and merging.
## adding neighborhood information to the shooting dataset
```{r, message=FALSE}
df=read_csv("NYPD_Shooting_Incident_Data__Historic__20241119.csv")

# Ensure coordinate columns are numeric
df = df %>%
  mutate(
    X_COORD_CD = as.numeric(X_COORD_CD),
    Y_COORD_CD = as.numeric(Y_COORD_CD)
  )

# Convert to sf object with CRS EPSG:2263
df_sf = st_as_sf(df, coords = c("X_COORD_CD", "Y_COORD_CD"), crs = 2263)

# Download and read the GeoJSON file
download.file(
  url = "https://data.insideairbnb.com/united-states/ny/new-york-city/2024-09-04/visualisations/neighbourhoods.geojson",
  destfile = "neighbourhoods.geojson",
  mode = "wb"
)
neighbourhoods = st_read("neighbourhoods.geojson")

# Check and transform CRS of neighborhoods
if (st_crs(neighbourhoods)$epsg != 2263) {
  neighbourhoods = st_transform(neighbourhoods, crs = 2263)
}

# Perform the spatial join
df_joined = st_join(df_sf, neighbourhoods, left = TRUE)

# Add neighborhood information to the data frame
df$Neighborhood = df_joined$neighbourhood

# Download and use the neighborhoods CSV file
download.file(
  url = "https://data.insideairbnb.com/united-states/ny/new-york-city/2024-09-04/visualisations/neighbourhoods.csv",
  destfile = "neighbourhoods.csv",
  mode = "wb"
)
neighborhoods_csv = read_csv("neighbourhoods.csv")

# Merge additional attributes if necessary
df = df %>%
  left_join(neighborhoods_csv, by = c("Neighborhood" = "neighbourhood"))

# Save the updated data frame
write_csv(df, "data_with_neighborhoods.csv")
```