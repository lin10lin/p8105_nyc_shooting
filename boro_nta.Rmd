---
title: "boro_nta"
output: github_document
date: "2024-12-03"
---

load packages
```{r}
library(ggplot2)
library(readxl)
library(readr)
library(tidyverse)
library(dplyr)
library(sf)

```

load dataset
```{r}
df_descriptive=read_csv("filtered_merged_dataset_sample.csv")
data_final <- read_csv("data_final.csv")
```


Plot of the number of incidents in each borough for each year
 
```{r}
# Summarize data: count the number of incidents by borough and year
incident_summary <- df_descriptive %>%
  group_by(BORO, Year) %>%
  summarise(Number_of_Incidents = n(), .groups = "drop") %>%
  # Ensure missing years and boroughs are included
  complete(BORO, Year = full_seq(min(df_descriptive$Year):max(df_descriptive$Year), 1), fill = list(Number_of_Incidents = 0))

# Create the bar plot
ggplot(incident_summary, aes(x = Year, y = Number_of_Incidents, fill = BORO)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Number of Incidents in Each Borough by Year",
    x = "Year",
    y = "Number of Incidents",
    fill = "Borough"
  ) +
  scale_x_continuous(breaks = seq(min(df_descriptive$Year), max(df_descriptive$Year), by = 1)) +
  theme_minimal()
```


```{r}
nta_summary <- df_descriptive %>%
  group_by(NTA_clean, BORO) %>%                 # Group by NTA and BORO
  summarise(Number_of_Incidents = n(), .groups = "drop") %>%  # Count incidents
  arrange(desc(Number_of_Incidents)) %>%  # Sort in descending order
  slice_head(n = 10)
nta_summary
```
 
##Total incidents per NTA
 
Load spatial data (replace with actual shapefile path)
```{r}
nta_shape <- st_read("nynta2020_24d/nynta2020.shp")
```


```{r}
# Prepare incident data: count incidents per NTA_clean
nta_incident_counts <- data_final %>%
  group_by(NTA) %>%
  summarise(Number_of_Incidents = n(), .groups = "drop")

# Merge spatial data with incident counts
nta_map_data <- nta_shape %>%
  left_join(nta_incident_counts, by = c("NTAName" = "NTA"))

# Create custom breaks for Number_of_Incidents
nta_map_data <- nta_map_data %>%
  mutate(
    Incident_Range = cut(
      Number_of_Incidents,
      breaks = seq(0, 400, by = 80),  # Breaks from 0 to 1000, every 200 cases
      labels = c("0-80", "81-160", "161-240", "241-320", "321-400"),
      include.lowest = TRUE
    )
  )



```





Plot the map

```{r}
# Plot the map with custom ranges
ggplot(data = nta_map_data) +
  geom_sf(aes(fill = Incident_Range), color = "white", size = 0.2) +
  scale_fill_manual(
    values = c(
      "0-80" = "#edf8fb",
      "81-160" = "#b2e2e2",
      "161-240" = "#66c2a4",
      "241-320" = "#2ca25f",
      "321-400" = "#006d2c"
    ),
    name = "Number of Incidents"
  ) +
  labs(
    title = "Total Number of Incidents Across NYC NTAs from 2017 to 2023",
    subtitle = "Incidents grouped by range (0-1000, 200 breaks)",
    caption = "Data Source: Your dataset"
  ) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.ticks = element_blank(),
    panel.grid = element_blank()
  )

```






```{r}
```


```{r}
```
 
 